<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reservation Lookup - Moffat Bay Lodge</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Open+Sans&display=swap" rel="stylesheet" />
</head>
<body>

  <!-- HEADER + NAVIGATION BAR -->
  {% include "partials/header_and_navbar.html" %}

    <!-- Flash Messages -->
  {% include "partials/success_flash_messages.html" %}
  {% include "partials/error_flash_messages.html" %}

  <main class="page-content">
    <section class="lookup-section">
      
      <header>
        <h1>Reservation Lookup</h1>
        <p>Look up your reservation by entering your email or reservation ID below.</p>
      </header>

      <div class="lookup-container">

        <h2>Find Your Reservation</h2>

      <form method="GET" action="{{ url_for('reservation_lookup') }}">
        <input type="text" id="lookupId" class="lookup-input" placeholder="Email or Reservation ID" name="q" value="{{ request.args.get('q', '') }}" required>
        <button type="submit" class="btn-brown">Lookup Reservation</button>
      </form>

      {% if reservations is defined %}
        {% if reservations %}
          <table>
            <thead>
              <tr>
                <th>Reservation ID</th>
                <th>Room #</th>
                <th>Room Type</th>
                <th>Bed Configuration</th>
                <th>Guests</th>
                <th>Name</th>
                <th>Email</th>
                <th>Check-In</th>
                <th>Check-Out</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              {% for reservation in reservations %}
                <tr>
                  <td>{{ reservation.ReservationID }}</td>
                  <td>{{ reservation.RoomNumber }}</td>
                  <td>{{ reservation.TypeName }}</td>
                  <td>{{ reservation.BedConfiguration }}</td>
                  <td>{{ reservation.NumberOfGuests }}</td>
                  <td>{{ reservation.FirstName }} {{ reservation.LastName }}</td>
                  <td>{{ reservation.Email }}</td>
                  <td>{{ reservation.CheckInDate.strftime('%Y-%m-%d') }}</td>
                  <td>{{ reservation.CheckOutDate.strftime('%Y-%m-%d') }}</td>
                  <td>{{ reservation.ReservationStatus }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>

          {% if total_pages > 1 %}
          <nav class="pagination" aria-label="Reservations pages">
            <ul>
              <li>
                <a class="page-link {% if page <= 1 %}disabled{% endif %}"
                  href="{% if page > 1 %}{{ url_for('reservation_lookup', q=q, page=page-1) }}{% else %}#{% endif %}"
                  aria-disabled="{{ 'true' if page <= 1 else 'false' }}">&laquo; Previous</a>
              </li>

              <li class="page-status">Page {{ page }} of {{ total_pages }}</li>

              <li>
                <a class="page-link {% if page >= total_pages %}disabled{% endif %}"
                  href="{% if page < total_pages %}{{ url_for('reservation_lookup', q=q, page=page+1) }}{% else %}#{% endif %}"
                  aria-disabled="{{ 'true' if page >= total_pages else 'false' }}">Next &raquo;</a>
              </li>
            </ul>
          </nav>
          {% endif %}

        {% else %}
          {% if request.args.get('q') %}
            <p>No reservations found for your search.</p>
          {% elif session["customer_id"] %}
            <p>You have no reservations.</p>
          {% else %}
            <p>Please enter your email or reservation ID to look up your reservation.</p>
          {% endif %}
        {% endif %}
      {% else %}
        <p>Please enter your email or reservation ID to look up your reservation.</p>
      {% endif %}
      </div>
    </section>
  </main>

<!-- FOOTER WITH PAGE LINKS -->
{% include "partials/footer.html" %}

<!-- LOGIN MODAL (Pop-up Overlay) -->
{% include "partials/login_modal.html" %}

<script>
    // Login Modal functionality
    const loginModal = document.getElementById('loginModal');
    const loginBtn = document.getElementById('loginBtn');
    const closeTriggers = document.querySelectorAll('[data-close-modal]');

    if (loginBtn) {
      loginBtn.addEventListener('click', () => {
        loginModal.classList.add('show');
      });
    }

    closeTriggers.forEach(el => {
      el.addEventListener('click', () => {
        loginModal.classList.remove('show');
      });
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === "Escape") {
        loginModal.classList.remove('show');
      }
    });
  </script>

</body>
</html>